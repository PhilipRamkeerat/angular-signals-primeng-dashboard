<div class="min-h-screen bg-gray-50">
  <p-toast></p-toast>
  
  <div class="bg-white shadow-sm border-b backdrop-blur-sm bg-white/95">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center space-x-3">
          <div class="bg-blue-600 text-white rounded-lg p-2 transition-all duration-200 hover:scale-110">
            <i class="pi pi-chart-bar text-xl"></i>
          </div>
          <h1 class="text-xl font-semibold text-gray-900">Dashboard</h1>
        </div>
        
        <div class="flex items-center space-x-4">
          <p-button
            icon="pi pi-refresh"
            [text]="true"
            [rounded]="true"
            severity="secondary"
            (onClick)="resetLayout()"
            pTooltip="Reset Layout"
            tooltipPosition="bottom"
            class="transition-all duration-200 hover:scale-110"
          ></p-button>
          
          <div class="text-right hidden sm:block">
            <p class="text-sm font-medium text-gray-900">{{ currentUser?.username }}</p>
            <p class="text-xs text-gray-500">{{ currentUser?.email }}</p>
          </div>
          <p-avatar 
            [label]="getInitials(currentUser?.username || 'U')" 
            styleClass="bg-blue-500 text-white transition-all duration-200 hover:scale-110"
            size="large"
          ></p-avatar>
          <p-button
            icon="pi pi-sign-out"
            [text]="true"
            [rounded]="true"
            severity="danger"
            (onClick)="logout()"
            pTooltip="Logout"
            tooltipPosition="bottom"
            class="transition-all duration-200 hover:scale-110"
          ></p-button>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <div class="mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">
        Welcome back, {{ currentUser?.username }}! ðŸ‘‹
      </h2>
      <p class="text-gray-600">
        Drag and drop widgets to customize your dashboard layout.
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 auto-rows-fr">
      <div 
        class="min-h-[400px] transition-all duration-300 rounded-lg"
        [class.ring-2]="dragOverIndex === 0"
        [class.ring-blue-500]="dragOverIndex === 0"
        [class.ring-opacity-50]="dragOverIndex === 0"
        pDroppable="widgets"
        (onDrop)="onDrop(0)"
        (onDragEnter)="onDragEnter(0)"
        (onDragLeave)="onDragLeave()"
      >
        <div 
          *ngIf="getWidgetByPosition(0, 0) as widget"
          class="h-full cursor-move"
          pDraggable="widgets"
          (onDragStart)="onDragStart(widget)"
          (onDragEnd)="onDragEnd()"
        >
          <app-weather-widget 
            *ngIf="widget.type === 'weather'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-weather-widget>
          <app-chart-widget 
            *ngIf="widget.type === 'chart'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-chart-widget>
          <app-task-list-widget 
            *ngIf="widget.type === 'tasks'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-task-list-widget>
          <app-quick-stats-widget 
            *ngIf="widget.type === 'stats'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-quick-stats-widget>
        </div>
      </div>

      <div 
        class="min-h-[400px] transition-all duration-300 rounded-lg"
        [class.ring-2]="dragOverIndex === 1"
        [class.ring-blue-500]="dragOverIndex === 1"
        [class.ring-opacity-50]="dragOverIndex === 1"
        pDroppable="widgets"
        (onDrop)="onDrop(1)"
        (onDragEnter)="onDragEnter(1)"
        (onDragLeave)="onDragLeave()"
      >
        <div 
          *ngIf="getWidgetByPosition(0, 1) as widget"
          class="h-full cursor-move"
          pDraggable="widgets"
          (onDragStart)="onDragStart(widget)"
          (onDragEnd)="onDragEnd()"
        >
          <app-weather-widget 
            *ngIf="widget.type === 'weather'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-weather-widget>
          <app-chart-widget 
            *ngIf="widget.type === 'chart'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-chart-widget>
          <app-task-list-widget 
            *ngIf="widget.type === 'tasks'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-task-list-widget>
          <app-quick-stats-widget 
            *ngIf="widget.type === 'stats'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-quick-stats-widget>
        </div>
      </div>

      <div 
        class="min-h-[400px] transition-all duration-300 rounded-lg"
        [class.ring-2]="dragOverIndex === 2"
        [class.ring-blue-500]="dragOverIndex === 2"
        [class.ring-opacity-50]="dragOverIndex === 2"
        pDroppable="widgets"
        (onDrop)="onDrop(2)"
        (onDragEnter)="onDragEnter(2)"
        (onDragLeave)="onDragLeave()"
      >
        <div 
          *ngIf="getWidgetByPosition(1, 0) as widget"
          class="h-full cursor-move"
          pDraggable="widgets"
          (onDragStart)="onDragStart(widget)"
          (onDragEnd)="onDragEnd()"
        >
          <app-weather-widget 
            *ngIf="widget.type === 'weather'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-weather-widget>
          <app-chart-widget 
            *ngIf="widget.type === 'chart'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-chart-widget>
          <app-task-list-widget 
            *ngIf="widget.type === 'tasks'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-task-list-widget>
          <app-quick-stats-widget 
            *ngIf="widget.type === 'stats'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-quick-stats-widget>
        </div>
      </div>

      <div 
        class="min-h-[400px] transition-all duration-300 rounded-lg"
        [class.ring-2]="dragOverIndex === 3"
        [class.ring-blue-500]="dragOverIndex === 3"
        [class.ring-opacity-50]="dragOverIndex === 3"
        pDroppable="widgets"
        (onDrop)="onDrop(3)"
        (onDragEnter)="onDragEnter(3)"
        (onDragLeave)="onDragLeave()"
      >
        <div 
          *ngIf="getWidgetByPosition(1, 1) as widget"
          class="h-full cursor-move"
          pDraggable="widgets"
          (onDragStart)="onDragStart(widget)"
          (onDragEnd)="onDragEnd()"
        >
          <app-weather-widget 
            *ngIf="widget.type === 'weather'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-weather-widget>
          <app-chart-widget 
            *ngIf="widget.type === 'chart'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-chart-widget>
          <app-task-list-widget 
            *ngIf="widget.type === 'tasks'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-task-list-widget>
          <app-quick-stats-widget 
            *ngIf="widget.type === 'stats'"
            (dragStart)="onDragStart(widget)"
            class="block h-full"
          ></app-quick-stats-widget>
        </div>
      </div>
    </div>

    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <div class="flex items-start">
        <i class="pi pi-info-circle text-blue-500 mt-0.5 mr-3"></i>
        <div>
          <h4 class="text-sm font-semibold text-blue-800 mb-1">How to use</h4>
          <p class="text-sm text-blue-700">
            Click and drag any widget to move it to a different position in the grid. 
            Use the reset button in the header to restore the default layout.
          </p>
        </div>
      </div>
    </div>
  </div>
</div> 